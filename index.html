<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Conference Event Organizer</title>
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: Arial, sans-serif;
            background-color: #f5f5f5;
            padding: 20px;
        }
        
        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            padding: 30px;
            border-radius: 8px;
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
        }
        
        h1 {
            color: #333;
            margin-bottom: 30px;
            text-align: center;
        }
        
        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: none;
            border: none;
            font-size: 16px;
            color: #666;
            border-bottom: 2px solid transparent;
            margin-bottom: -2px;
        }
        
        .tab.active {
            color: #007bff;
            border-bottom-color: #007bff;
            font-weight: bold;
        }
        
        .form-section {
            background: #f9f9f9;
            padding: 20px;
            border-radius: 5px;
            margin-bottom: 30px;
        }
        
        .form-group {
            margin-bottom: 15px;
        }
        
        label {
            display: block;
            margin-bottom: 5px;
            color: #333;
            font-weight: bold;
        }
        
        input, textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
        }
        
        button {
            padding: 10px 20px;
            background: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 14px;
            margin-right: 10px;
        }
        
        button:hover {
            background: #0056b3;
        }
        
        button.delete {
            background: #dc3545;
        }
        
        button.delete:hover {
            background: #c82333;
        }
        
        .list-section {
            margin-top: 30px;
        }
        
        .item-card {
            background: white;
            border: 1px solid #ddd;
            padding: 15px;
            margin-bottom: 15px;
            border-radius: 5px;
        }
        
        .item-card h3 {
            color: #007bff;
            margin-bottom: 10px;
        }
        
        .item-card p {
            color: #666;
            margin: 5px 0;
        }
        
        .error {
            color: #dc3545;
            background: #f8d7da;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        .success {
            color: #155724;
            background: #d4edda;
            padding: 10px;
            border-radius: 4px;
            margin-bottom: 15px;
        }
        
        select {
            width: 100%;
            padding: 10px;
            border: 1px solid #ddd;
            border-radius: 4px;
            font-size: 14px;
            background: white;
        }
        
        button:disabled {
            background: #ccc;
            cursor: not-allowed;
        }
    </style>
</head>
<body>
    <div id="root"></div>
    
    <script type="text/babel">
        // ============================================================================
        // FRONTEND INTEGRATION - Technical Objective: Frontend Integration
        // ============================================================================
        // Requirement: Frontend Integration - Ensure existing AngularJS or React pages 
        //              continue to work after moving to database backend
        // Requirement: Demonstrate end-to-end functionality from frontend to database
        
        const { useState, useEffect } = React;
        
        // Main App Component
        function App() {
            const [activeTab, setActiveTab] = useState('attendees');
            
            return (
                <div className="container">
                    <h1>Conference Event Organizer</h1>
                    <div className="tabs">
                        <button 
                            className={`tab ${activeTab === 'attendees' ? 'active' : ''}`}
                            onClick={() => setActiveTab('attendees')}
                        >
                            Attendees
                        </button>
                        <button 
                            className={`tab ${activeTab === 'sessions' ? 'active' : ''}`}
                            onClick={() => setActiveTab('sessions')}
                        >
                            Sessions
                        </button>
                        <button 
                            className={`tab ${activeTab === 'register' ? 'active' : ''}`}
                            onClick={() => setActiveTab('register')}
                        >
                            Register for Sessions
                        </button>
                    </div>
                    
                    {activeTab === 'attendees' && <AttendeesManager />}
                    {activeTab === 'sessions' && <SessionsManager />}
                    {activeTab === 'register' && <RegistrationManager />}
                </div>
            );
        }
        
        // ============================================================================
        // ATTENDEES COMPONENT - Frontend for First Entity
        // ============================================================================
        // Requirement: Frontend pages that still work correctly after database integration
        // Requirement: Demonstrate end-to-end functionality from frontend to database
        
        function AttendeesManager() {
            const [attendees, setAttendees] = useState([]);
            const [formData, setFormData] = useState({ name: '', email: '', phone: '' });
            const [editingId, setEditingId] = useState(null);
            const [message, setMessage] = useState('');
            const [error, setError] = useState('');
            
            // Load attendees from database
            useEffect(() => {
                fetchAttendees();
            }, []);
            
            // READ operation - Fetch all attendees
            const fetchAttendees = async () => {
                try {
                    const response = await fetch('/api/attendees');
                    const data = await response.json();
                    setAttendees(data);
                } catch (err) {
                    setError('Failed to load attendees');
                }
            };
            
            // CREATE operation - Add new attendee
            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setMessage('');
                
                try {
                    const url = editingId ? `/api/attendees/${editingId}` : '/api/attendees';
                    const method = editingId ? 'PUT' : 'POST';
                    
                    const response = await fetch(url, {
                        method: method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify(formData)
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        setMessage(editingId ? 'Attendee updated successfully!' : 'Attendee created successfully!');
                        setFormData({ name: '', email: '', phone: '' });
                        setEditingId(null);
                        fetchAttendees();
                    } else {
                        setError(data.error || 'Operation failed');
                    }
                } catch (err) {
                    setError('Failed to save attendee');
                }
            };
            
            // UPDATE operation - Edit attendee
            const handleEdit = (attendee) => {
                setFormData({
                    name: attendee.name,
                    email: attendee.email,
                    phone: attendee.phone || ''
                });
                setEditingId(attendee.id);
            };
            
            // DELETE operation - Remove attendee
            const handleDelete = async (id) => {
                if (!window.confirm('Are you sure you want to delete this attendee?')) {
                    return;
                }
                
                try {
                    const response = await fetch(`/api/attendees/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        setMessage('Attendee deleted successfully!');
                        fetchAttendees();
                    } else {
                        const data = await response.json();
                        setError(data.error || 'Failed to delete');
                    }
                } catch (err) {
                    setError('Failed to delete attendee');
                }
            };
            
            return (
                <div>
                    <div className="form-section">
                        <h2>{editingId ? 'Edit Attendee' : 'Register New Attendee'}</h2>
                        {error && <div className="error">{error}</div>}
                        {message && <div className="success">{message}</div>}
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>Name *</label>
                                <input
                                    type="text"
                                    value={formData.name}
                                    onChange={(e) => setFormData({...formData, name: e.target.value})}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>Email *</label>
                                <input
                                    type="email"
                                    value={formData.email}
                                    onChange={(e) => setFormData({...formData, email: e.target.value})}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>Phone</label>
                                <input
                                    type="text"
                                    value={formData.phone}
                                    onChange={(e) => setFormData({...formData, phone: e.target.value})}
                                />
                            </div>
                            <button type="submit">{editingId ? 'Update Attendee' : 'Register Attendee'}</button>
                            {editingId && (
                                <button type="button" onClick={() => {
                                    setFormData({ name: '', email: '', phone: '' });
                                    setEditingId(null);
                                }}>
                                    Cancel
                                </button>
                            )}
                        </form>
                    </div>
                    
                    <div className="list-section">
                        <h2>Registered Attendees ({attendees.length})</h2>
                        {attendees.map(attendee => (
                            <div key={attendee.id} className="item-card">
                                <h3>{attendee.name}</h3>
                                <p><strong>Email:</strong> {attendee.email}</p>
                                <p><strong>Phone:</strong> {attendee.phone || 'N/A'}</p>
                                <p><strong>Registered:</strong> {new Date(attendee.registration_date).toLocaleDateString()}</p>
                                <button onClick={() => handleEdit(attendee)}>Edit</button>
                                <button className="delete" onClick={() => handleDelete(attendee.id)}>Delete</button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        
        // ============================================================================
        // SESSIONS COMPONENT - Frontend for Second Entity
        // ============================================================================
        // Requirement: Frontend pages that still work correctly after database integration
        // Requirement: Demonstrate end-to-end functionality from frontend to database
        
        function SessionsManager() {
            const [sessions, setSessions] = useState([]);
            const [formData, setFormData] = useState({ 
                title: '', speaker: '', time: '', location: '', description: '', capacity: 50 
            });
            const [editingId, setEditingId] = useState(null);
            const [message, setMessage] = useState('');
            const [error, setError] = useState('');
            
            // Load sessions from database
            useEffect(() => {
                fetchSessions();
            }, []);
            
            // READ operation - Fetch all sessions
            const fetchSessions = async () => {
                try {
                    const response = await fetch('/api/sessions');
                    const data = await response.json();
                    setSessions(data);
                } catch (err) {
                    setError('Failed to load sessions');
                }
            };
            
            // CREATE operation - Add new session
            const handleSubmit = async (e) => {
                e.preventDefault();
                setError('');
                setMessage('');
                
                try {
                    const url = editingId ? `/api/sessions/${editingId}` : '/api/sessions';
                    const method = editingId ? 'PUT' : 'POST';
                    
                    const response = await fetch(url, {
                        method: method,
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            ...formData,
                            capacity: parseInt(formData.capacity) || 50
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        setMessage(editingId ? 'Session updated successfully!' : 'Session created successfully!');
                        setFormData({ title: '', speaker: '', time: '', location: '', description: '', capacity: 50 });
                        setEditingId(null);
                        fetchSessions();
                    } else {
                        setError(data.error || 'Operation failed');
                    }
                } catch (err) {
                    setError('Failed to save session');
                }
            };
            
            // UPDATE operation - Edit session
            const handleEdit = (session) => {
                setFormData({
                    title: session.title,
                    speaker: session.speaker,
                    time: session.time,
                    location: session.location,
                    description: session.description || '',
                    capacity: session.capacity
                });
                setEditingId(session.id);
            };
            
            // DELETE operation - Remove session
            const handleDelete = async (id) => {
                if (!window.confirm('Are you sure you want to delete this session?')) {
                    return;
                }
                
                try {
                    const response = await fetch(`/api/sessions/${id}`, {
                        method: 'DELETE'
                    });
                    
                    if (response.ok) {
                        setMessage('Session deleted successfully!');
                        fetchSessions();
                    } else {
                        const data = await response.json();
                        setError(data.error || 'Failed to delete');
                    }
                } catch (err) {
                    setError('Failed to delete session');
                }
            };
            
            return (
                <div>
                    <div className="form-section">
                        <h2>{editingId ? 'Edit Session' : 'Create New Session'}</h2>
                        {error && <div className="error">{error}</div>}
                        {message && <div className="success">{message}</div>}
                        <form onSubmit={handleSubmit}>
                            <div className="form-group">
                                <label>Title *</label>
                                <input
                                    type="text"
                                    value={formData.title}
                                    onChange={(e) => setFormData({...formData, title: e.target.value})}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>Speaker *</label>
                                <input
                                    type="text"
                                    value={formData.speaker}
                                    onChange={(e) => setFormData({...formData, speaker: e.target.value})}
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>Time *</label>
                                <input
                                    type="text"
                                    value={formData.time}
                                    onChange={(e) => setFormData({...formData, time: e.target.value})}
                                    placeholder="e.g., 10:00 AM"
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>Location *</label>
                                <input
                                    type="text"
                                    value={formData.location}
                                    onChange={(e) => setFormData({...formData, location: e.target.value})}
                                    placeholder="e.g., Room A"
                                    required
                                />
                            </div>
                            <div className="form-group">
                                <label>Description</label>
                                <textarea
                                    value={formData.description}
                                    onChange={(e) => setFormData({...formData, description: e.target.value})}
                                    rows="3"
                                />
                            </div>
                            <div className="form-group">
                                <label>Capacity</label>
                                <input
                                    type="number"
                                    value={formData.capacity}
                                    onChange={(e) => setFormData({...formData, capacity: e.target.value})}
                                    min="1"
                                />
                            </div>
                            <button type="submit">{editingId ? 'Update Session' : 'Create Session'}</button>
                            {editingId && (
                                <button type="button" onClick={() => {
                                    setFormData({ title: '', speaker: '', time: '', location: '', description: '', capacity: 50 });
                                    setEditingId(null);
                                }}>
                                    Cancel
                                </button>
                            )}
                        </form>
                    </div>
                    
                    <div className="list-section">
                        <h2>Conference Sessions ({sessions.length})</h2>
                        {sessions.map(session => (
                            <div key={session.id} className="item-card">
                                <h3>{session.title}</h3>
                                <p><strong>Speaker:</strong> {session.speaker}</p>
                                <p><strong>Time:</strong> {session.time}</p>
                                <p><strong>Location:</strong> {session.location}</p>
                                <p><strong>Capacity:</strong> {session.capacity} attendees</p>
                                {session.description && <p><strong>Description:</strong> {session.description}</p>}
                                <button onClick={() => handleEdit(session)}>Edit</button>
                                <button className="delete" onClick={() => handleDelete(session.id)}>Delete</button>
                            </div>
                        ))}
                    </div>
                </div>
            );
        }
        
        // ============================================================================
        // REGISTRATION MANAGER - Session Registration Feature
        // ============================================================================
        // Allows attendees to register for available sessions
        
        function RegistrationManager() {
            const [attendees, setAttendees] = useState([]);
            const [sessions, setSessions] = useState([]);
            const [selectedAttendee, setSelectedAttendee] = useState('');
            const [message, setMessage] = useState('');
            const [error, setError] = useState('');
            
            // Load attendees and sessions
            useEffect(() => {
                fetchAttendees();
                fetchSessions();
            }, []);
            
            // Load session details with registration counts
            useEffect(() => {
                if (sessions.length > 0) {
                    sessions.forEach(session => {
                        fetchSessionDetails(session.id);
                    });
                }
            }, [sessions.length]);
            
            const fetchAttendees = async () => {
                try {
                    const response = await fetch('/api/attendees');
                    const data = await response.json();
                    setAttendees(data);
                } catch (err) {
                    setError('Failed to load attendees');
                }
            };
            
            const fetchSessions = async () => {
                try {
                    const response = await fetch('/api/sessions');
                    const data = await response.json();
                    setSessions(data);
                } catch (err) {
                    setError('Failed to load sessions');
                }
            };
            
            const fetchSessionDetails = async (sessionId) => {
                try {
                    const response = await fetch(`/api/sessions/${sessionId}/details`);
                    const data = await response.json();
                    setSessions(prev => prev.map(s => 
                        s.id === sessionId ? { ...s, registered: data.registered, available: data.available } : s
                    ));
                } catch (err) {
                    console.error('Failed to load session details');
                }
            };
            
            const handleRegister = async (sessionId) => {
                if (!selectedAttendee) {
                    setError('Please select an attendee first');
                    return;
                }
                
                setError('');
                setMessage('');
                
                try {
                    const response = await fetch('/api/registrations', {
                        method: 'POST',
                        headers: { 'Content-Type': 'application/json' },
                        body: JSON.stringify({
                            attendee_id: parseInt(selectedAttendee),
                            session_id: sessionId
                        })
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        setMessage('Successfully registered for session!');
                        fetchSessionDetails(sessionId);
                        // Reload sessions to update counts
                        setTimeout(() => fetchSessions(), 500);
                    } else {
                        setError(data.error || 'Failed to register');
                    }
                } catch (err) {
                    setError('Failed to register for session');
                }
            };
            
            const handleUnregister = async (sessionId) => {
                if (!selectedAttendee) {
                    setError('Please select an attendee first');
                    return;
                }
                
                setError('');
                setMessage('');
                
                try {
                    const response = await fetch(`/api/registrations/${selectedAttendee}/${sessionId}`, {
                        method: 'DELETE'
                    });
                    
                    const data = await response.json();
                    
                    if (response.ok) {
                        setMessage('Successfully unregistered from session!');
                        fetchSessionDetails(sessionId);
                        setTimeout(() => fetchSessions(), 500);
                    } else {
                        setError(data.error || 'Failed to unregister');
                    }
                } catch (err) {
                    setError('Failed to unregister from session');
                }
            };
            
            const getAttendeeRegistrations = async (attendeeId) => {
                try {
                    const response = await fetch(`/api/attendees/${attendeeId}/registrations`);
                    const data = await response.json();
                    return data.map(r => r.session_id);
                } catch (err) {
                    return [];
                }
            };
            
            const [registeredSessions, setRegisteredSessions] = useState([]);
            
            useEffect(() => {
                if (selectedAttendee) {
                    getAttendeeRegistrations(selectedAttendee).then(sessionIds => {
                        setRegisteredSessions(sessionIds);
                    });
                }
            }, [selectedAttendee]);
            
            return (
                <div>
                    <div className="form-section">
                        <h2>Register Attendees for Sessions</h2>
                        {error && <div className="error">{error}</div>}
                        {message && <div className="success">{message}</div>}
                        <div className="form-group">
                            <label>Select Attendee *</label>
                            <select
                                value={selectedAttendee}
                                onChange={(e) => setSelectedAttendee(e.target.value)}
                                style={{ width: '100%', padding: '10px', fontSize: '14px', border: '1px solid #ddd', borderRadius: '4px' }}
                            >
                                <option value="">-- Select an attendee --</option>
                                {attendees.map(attendee => (
                                    <option key={attendee.id} value={attendee.id}>
                                        {attendee.name} ({attendee.email})
                                    </option>
                                ))}
                            </select>
                        </div>
                        {selectedAttendee && (
                            <p style={{ color: '#666', marginTop: '10px' }}>
                                Selected: {attendees.find(a => a.id === parseInt(selectedAttendee))?.name}
                            </p>
                        )}
                    </div>
                    
                    <div className="list-section">
                        <h2>Available Sessions</h2>
                        {sessions.length === 0 ? (
                            <p>No sessions available. Create sessions in the Sessions tab first.</p>
                        ) : (
                            sessions.map(session => {
                                const isRegistered = registeredSessions.includes(session.id);
                                const isFull = session.available !== undefined && session.available <= 0;
                                
                                return (
                                    <div key={session.id} className="item-card">
                                        <h3>{session.title}</h3>
                                        <p><strong>Speaker:</strong> {session.speaker}</p>
                                        <p><strong>Time:</strong> {session.time}</p>
                                        <p><strong>Location:</strong> {session.location}</p>
                                        <p><strong>Capacity:</strong> {session.capacity} attendees</p>
                                        {session.registered !== undefined && (
                                            <p><strong>Registered:</strong> {session.registered} / {session.capacity} 
                                               ({session.available} spots available)</p>
                                        )}
                                        {session.description && <p><strong>Description:</strong> {session.description}</p>}
                                        
                                        {selectedAttendee ? (
                                            isRegistered ? (
                                                <button className="delete" onClick={() => handleUnregister(session.id)}>
                                                    Unregister
                                                </button>
                                            ) : isFull ? (
                                                <button disabled style={{ background: '#ccc', cursor: 'not-allowed' }}>
                                                    Session Full
                                                </button>
                                            ) : (
                                                <button onClick={() => handleRegister(session.id)}>
                                                    Register for This Session
                                                </button>
                                            )
                                        ) : (
                                            <p style={{ color: '#666', fontStyle: 'italic' }}>
                                                Select an attendee above to register
                                            </p>
                                        )}
                                    </div>
                                );
                            })
                        )}
                    </div>
                </div>
            );
        }
        
        // Render the app
        ReactDOM.render(<App />, document.getElementById('root'));
    </script>
</body>
</html>

